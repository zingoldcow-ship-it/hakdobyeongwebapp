<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>학도병 탐구 웹앱</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <div class="wrap">
    <div class="page-title">
      <div class="pill pill-title">학도병 이해 및 탐구 웹앱</div>
      <p class="muted">반·번호·이름을 입력하고, 오늘의 탐구를 시작해요.</p>
    </div>

    <div class="cards">
      <section class="card card-yellow">
        <h2>탐구 시작 다짐</h2>
        <p class="muted preline">
나는 지금부터 한국전쟁 당시 등장한 학도병에 대해 알아보기 위한 탐구를 시작한다.

이 탐구에서는 한 사람의 이야기가 아니라, 여러 기록에 나타난 사실과 상황을 차례대로 살펴본다.
감정이나 판단보다 먼저, 당시의 조건과 선택을 정확히 이해하는 것을 목표로 한다.

탐구가 끝난 뒤에는 학도병이 한국전쟁 속에서 어떤 존재였는지를 나의 말로 정리해 볼 것이다.
        </p>
      </section>

      <section class="card card-mint">
        <h2>탐구 태도 체크</h2>
        <div class="checklist">
          <label class="checkitem"><input type="checkbox" id="c1"/><span>나는 자료를 읽고 근거를 찾아 생각한다.</span></label>
          <label class="checkitem"><input type="checkbox" id="c2"/><span>나는 다른 사람을 존중하며 나의 생각을 글로 정리한다.</span></label>
          <label class="checkitem"><input type="checkbox" id="c3"/><span>나는 모르는 내용이 있으면 자료를 다시 확인한다.</span></label>
        </div>
      </section>

      <section class="card card-blue">
        <h2>학생 정보 입력</h2>
        <div class="grid grid3">
          <div>
            <label class="label">반</label>
            <input id="class_name" placeholder="예) 6-3" autocomplete="off"/>
          </div>
          <div>
            <label class="label">번호</label>
            <input id="number" placeholder="예) 12" inputmode="numeric" autocomplete="off"/>
          </div>
          <div>
            <label class="label">이름</label>
            <input id="name" placeholder="예) 홍길동" autocomplete="off"/>
          </div>
        </div>

        <div style="margin-top:12px">
          <label class="label">수업 코드</label>
          <input id="run_id" placeholder="(자동 입력)" autocomplete="off"/>
          <div class="small muted" style="margin-top:6px">※ 수업 코드는 앱에 내장되어 자동 입력돼요.</div>
        </div>
      </section>

      <section class="card card-accent">
        <div class="row" style="justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div>
            <h2 style="margin:0 0 6px">준비가 되면 시작!</h2>
            <div class="small muted">Scene 1부터 차례대로 진행해요.</div>
          </div>
          <button class="btn primary btn-lg" id="startBtn">Scene 1으로 이동하기 →</button>
        </div>
      </section>
    </div>

    <div class="footer">
      <div class="muted small">본 앱은 수업용 탐구 활동 자료를 바탕으로 구성되었습니다. (출처는 시작 화면에서만 안내)</div>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/utils_legacy.js"></script>
  <script>
    const { setStudent, uid } = window.AppUtils;
    const $ = (id)=>document.getElementById(id);

    // Prefill embedded class/run code
    const embedded = (window.RUN_ID || "").trim();
    if(embedded){
      $('run_id').value = embedded;
      $('run_id').readOnly = true;
      $('run_id').setAttribute('aria-readonly','true');
    }

    function normalizeClass(s){
      return (s||"").trim();
    }
    function normalizeNumber(s){
      return (s||"").replace(/\s+/g,'').trim();
    }

    function validate(){
      const c1 = $('c1').checked, c2 = $('c2').checked, c3 = $('c3').checked;
      if(!(c1 && c2 && c3)) return { ok:false, msg:'탐구 태도 체크 3개를 모두 체크해 주세요.' };

      const class_name = normalizeClass($('class_name').value);
      const number = normalizeNumber($('number').value);
      const name = ($('name').value||"").trim();
      const run_id = ($('run_id').value||"").trim();

      if(!class_name) return { ok:false, msg:'반을 입력해 주세요.' };
      if(!number) return { ok:false, msg:'번호를 입력해 주세요.' };
      if(!/^[0-9]+$/.test(number)) return { ok:false, msg:'번호는 숫자만 입력해 주세요.' };
      if(!name) return { ok:false, msg:'이름을 입력해 주세요.' };

      if(embedded && run_id !== embedded){
        return { ok:false, msg:`수업 코드가 맞지 않아요. (자동 입력값: ${embedded})` };
      }
      if(!embedded && !run_id){
        return { ok:false, msg:'수업 코드를 입력해 주세요.' };
      }

      return { ok:true, profile:{
        run_id: embedded || run_id,
        class_name,
        number,
        name,
        student_id: `${class_name}-${number}-${name}`,
        run_session: uid(),
      }};
    }

    $('startBtn').addEventListener('click', ()=>{
      const v = validate();
      if(!v.ok){ alert(v.msg); return; }
      // run_id is also used as run_id in submissions
      setStudent({ ...v.profile, run_id: v.profile.run_id, run_id_label: v.profile.run_id });
      location.href = 'scene.html?scene=1';
    });

    // Enter key to start
    ['class_name','number','name'].forEach(id=>{
      $(id).addEventListener('keydown', (e)=>{ if(e.key==='Enter') $('startBtn').click(); });
    });
  
  </script>
</body>
</html>
